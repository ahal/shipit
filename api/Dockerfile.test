ARG PYTHON_VERSION

FROM python:${PYTHON_VERSION}

# %include taskcluster/scripts/poetry-setup
ADD topsrcdir/taskcluster/scripts/poetry-setup /tmp/poetry-setup
RUN /tmp/poetry-setup

WORKDIR /app

COPY pyproject.toml /app/

RUN poetry install --only tox --no-root

COPY tox.ini /app/

COPY src/ /app/src/

ENTRYPOINT ["/usr/local/bin/poetry", "run", "tox", "-e"]
